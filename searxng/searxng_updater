#!/bin/bash

# SearXNG frissítés és újraindítás script

# SearXNG telepítési könyvtár
SEARXNG_DIR="/usr/local/searxng/searxng-src"

# SearXNG futtató felhasználó
SEARXNG_USER="searxng"

# Virtuális környezet elérési útja
VENV_PATH="/usr/local/searxng/searx-pyenv"

echo "SearXNG frissítés kezdete..."

# Frissítés git pull segítségével
sudo -u $SEARXNG_USER bash -c "
    cd $SEARXNG_DIR &&
    git pull &&
    source $VENV_PATH/bin/activate &&
    pip install --upgrade -r requirements.txt &&
    deactivate
"

# Ha van systemd szolgáltatás, újraindítás
if systemctl is-active --quiet searxng; then
    echo "systemd szolgáltatás újraindítása..."
    sudo systemctl restart searxng
else
    echo "Nincs systemd szolgáltatás, kézzel indítsd újra SearXNG-t a változások életbe léptetéséhez."
fi

echo "SearXNG frissítés befejezve."
